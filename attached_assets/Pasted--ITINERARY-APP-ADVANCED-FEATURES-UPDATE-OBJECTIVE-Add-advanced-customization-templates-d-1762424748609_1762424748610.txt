# ITINERARY APP - ADVANCED FEATURES UPDATE

## OBJECTIVE
Add advanced customization, templates, draft management, and PDF improvements to the existing itinerary app.

## NEW FEATURES TO IMPLEMENT

### 1. CLICKABLE LINKS IN PDF EXPORTS

**Requirement:** All URLs in the PDF should be clickable hyperlinks.

**Implementation:**
Update the PDF export function in `client/src/utils/pdfExport.ts`:

```typescript
import jsPDF from 'jspdf';
import html2canvas from 'html2canvas';

export async function generateItineraryPDF(itinerarySlug: string) {
  const element = document.getElementById('itinerary-display');
  if (!element) return;
  
  // Before converting, ensure all links have proper href attributes
  const links = element.querySelectorAll('a');
  
  const canvas = await html2canvas(element, {
    scale: 2,
    useCORS: true,
    logging: false,
    allowTaint: true
  });
  
  const pdf = new jsPDF('p', 'mm', 'a4');
  const imgData = canvas.toDataURL('image/png');
  const imgWidth = 210;
  const pageHeight = 297;
  const imgHeight = (canvas.height * imgWidth) / canvas.width;
  let heightLeft = imgHeight;
  let position = 0;

  pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
  heightLeft -= pageHeight;

  while (heightLeft > 0) {
    position = heightLeft - imgHeight;
    pdf.addPage();
    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
    heightLeft -= pageHeight;
  }
  
  // Add clickable link annotations
  links.forEach((link: HTMLAnchorElement) => {
    const rect = link.getBoundingClientRect();
    const containerRect = element.getBoundingClientRect();
    
    // Calculate relative position in PDF
    const x = ((rect.left - containerRect.left) / containerRect.width) * imgWidth;
    const y = ((rect.top - containerRect.top) / containerRect.height) * imgHeight;
    const width = (rect.width / containerRect.width) * imgWidth;
    const height = (rect.height / containerRect.height) * imgHeight;
    
    // Add link annotation
    pdf.link(x, y, width, height, { url: link.href });
  });
  
  pdf.save(`${itinerarySlug}.pdf`);
}
```

**Display all links as blue, underlined in the itinerary view:**
- Google Maps links
- Booking URLs
- Consultant website
- Any other URLs

---

### 2. ADDITIONAL NOTES PAGE (WIZARD PAGE 9)

**Add new page to wizard:**

**Page 9: Additional Notes**
- Large text area for any additional information
- Optional section
- Examples shown: "Special dietary requirements", "Medical information", "Emergency contacts", etc.
- Can skip entirely

**Update wizard navigation:**
- Progress indicator: "Page X of 9"
- Add to wizard flow after Page 8 (Helpful Information)

---

### 3. FULLY CUSTOMIZABLE SECTIONS

**MAJOR FEATURE:** Replace fixed sections with a flexible custom section system.

#### 3.1 Database Schema Changes

**Add new table: CustomSection**
```typescript
CustomSection {
  id: string (uuid)
  itineraryId: string (foreign key)
  sectionName: string // e.g., "Accommodation", "Charging Points", "Visa Requirements"
  sectionType: string // "accommodation", "activity", "dining", "custom"
  displayOrder: number
  icon: string (optional) // emoji or icon name
}
```

**Add new table: CustomField**
```typescript
CustomField {
  id: string (uuid)
  customSectionId: string (foreign key)
  fieldName: string // e.g., "Name", "Address", "Voltage", "Processing Time"
  fieldType: string // "text", "textarea", "url", "date", "number", "email"
  fieldValue: string (stores the actual value)
  isRequired: boolean
  placeholder: string (optional)
  displayOrder: number
}
```

**Add new table: CustomSectionItem**
```typescript
CustomSectionItem {
  id: string (uuid)
  customSectionId: string (foreign key)
  displayOrder: number
}
```

**Add new table: CustomFieldValue**
```typescript
CustomFieldValue {
  id: string (uuid)
  customSectionItemId: string (foreign key)
  customFieldId: string (foreign key) // links to field definition
  value: string // the actual value for this item
}
```

**IMPORTANT:** This allows multiple items per section (e.g., 3 accommodations, 5 activities).

#### 3.2 Remove Old Fixed Schemas

**Delete these tables (migrate existing data to custom sections first):**
- Accommodation
- Activity
- Dining
- AdditionalTravel

**Keep but make optional:**
- OutboundTravel
- ReturnTravel
- HelpfulInformation

These are special structured sections that most itineraries need.

#### 3.3 API Routes for Custom Sections

```typescript
// Custom Sections
GET    /api/itinerary/:id/custom-sections              // Get all sections for itinerary
POST   /api/itinerary/:id/custom-sections              // Create new section
PATCH  /api/custom-sections/:id                        // Update section (name, order)
DELETE /api/custom-sections/:id                        // Delete section (cascade delete fields and items)

// Custom Fields (field definitions for a section)
GET    /api/custom-sections/:sectionId/fields          // Get field definitions
POST   /api/custom-sections/:sectionId/fields          // Add field definition
PATCH  /api/custom-fields/:id                          // Update field definition
DELETE /api/custom-fields/:id                          // Delete field definition

// Custom Section Items (individual entries like "Hotel ABC", "Eiffel Tower")
GET    /api/custom-sections/:sectionId/items           // Get all items in section
POST   /api/custom-sections/:sectionId/items           // Add new item
PATCH  /api/custom-section-items/:id                   // Update item
DELETE /api/custom-section-items/:id                   // Delete item

// Custom Field Values (the actual data)
GET    /api/custom-section-items/:itemId/values        // Get all field values for item
POST   /api/custom-section-items/:itemId/values        // Save field values
PATCH  /api/custom-field-values/:id                    // Update single value
```

#### 3.4 Section Builder UI

**In Wizard - Add Section Management:**

**Between each wizard page, show:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ“ Page 1: Travel Details           â”‚
â”‚  âœ“ Page 2: Outbound Travel          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚  [+ Add Custom Section]              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚  ğŸ“ Accommodation (3 items)          â”‚
â”‚     [Edit] [Delete] [â†‘] [â†“]         â”‚
â”‚  ğŸ¯ Activities (2 items)             â”‚
â”‚     [Edit] [Delete] [â†‘] [â†“]         â”‚
â”‚  âš¡ Charging Points (5 items)        â”‚
â”‚     [Edit] [Delete] [â†‘] [â†“]         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚  [+ Add Custom Section]              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚  âœ“ Page 7: Return Travel            â”‚
â”‚  âœ“ Page 8: Helpful Information      â”‚
â”‚  âœ“ Page 9: Additional Notes         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**"Add Custom Section" Modal:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Create Custom Section              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Section Name: [_________________]  â”‚
â”‚  Icon: [ğŸ¨] [dropdown of emojis]    â”‚
â”‚                                     â”‚
â”‚  Start from template:               â”‚
â”‚  â€¢ Blank (custom fields)            â”‚
â”‚  â€¢ Accommodation (Name, Address...) â”‚
â”‚  â€¢ Activity (Name, Description...)  â”‚
â”‚  â€¢ Dining (Name, Cuisine...)        â”‚
â”‚  â€¢ Transport (Type, Details...)     â”‚
â”‚                                     â”‚
â”‚  [Cancel] [Create Section]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Edit Section - Field Builder:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Section: Charging Points           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Fields:                            â”‚
â”‚                                     â”‚
â”‚  1. Station Name                    â”‚
â”‚     Type: Text                      â”‚
â”‚     [Edit] [Delete] [â†‘] [â†“]        â”‚
â”‚                                     â”‚
â”‚  2. Address                         â”‚
â”‚     Type: Text                      â”‚
â”‚     [Edit] [Delete] [â†‘] [â†“]        â”‚
â”‚                                     â”‚
â”‚  3. Charging Speed                  â”‚
â”‚     Type: Text                      â”‚
â”‚     [Edit] [Delete] [â†‘] [â†“]        â”‚
â”‚                                     â”‚
â”‚  4. Cost                            â”‚
â”‚     Type: Number                    â”‚
â”‚     [Edit] [Delete] [â†‘] [â†“]        â”‚
â”‚                                     â”‚
â”‚  5. Booking URL                     â”‚
â”‚     Type: URL                       â”‚
â”‚     [Edit] [Delete] [â†‘] [â†“]        â”‚
â”‚                                     â”‚
â”‚  [+ Add Field]                      â”‚
â”‚                                     â”‚
â”‚  [Save Section] [Cancel]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**"Add Field" Modal:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Add Field                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Field Name: [_________________]    â”‚
â”‚                                     â”‚
â”‚  Field Type:                        â”‚
â”‚  â—‹ Text (single line)               â”‚
â”‚  â—‹ Text Area (multiple lines)       â”‚
â”‚  â—‹ URL (with validation)            â”‚
â”‚  â—‹ Number                           â”‚
â”‚  â—‹ Date                             â”‚
â”‚  â—‹ Email                            â”‚
â”‚                                     â”‚
â”‚  â˜‘ Required field                   â”‚
â”‚                                     â”‚
â”‚  Placeholder: [_________________]   â”‚
â”‚                                     â”‚
â”‚  [Cancel] [Add Field]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Add Items to Section:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Charging Points (5 items)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [+ Add Charging Point]             â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€ Item 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Station Name: Tesla SC      â”‚    â”‚
â”‚  â”‚ Address: 123 Main St        â”‚    â”‚
â”‚  â”‚ Charging Speed: 250kW       â”‚    â”‚
â”‚  â”‚ Cost: Â£0.50/kWh            â”‚    â”‚
â”‚  â”‚ Booking URL: [link]         â”‚    â”‚
â”‚  â”‚ [Edit] [Delete] [â†‘] [â†“]    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€ Item 2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Station Name: Ionity        â”‚    â”‚
â”‚  â”‚ ...                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.5 Display Custom Sections

**In ViewItinerary.tsx:**

Dynamically render sections based on database:

```tsx
{customSections.map(section => (
  <div key={section.id} className="section">
    <h2>{section.icon} {section.sectionName}</h2>
    
    {section.items.map(item => (
      <div key={item.id} className="item-card">
        {item.fieldValues.map(fieldValue => (
          <div key={fieldValue.id}>
            <strong>{fieldValue.fieldName}:</strong>
            {fieldValue.fieldType === 'url' ? (
              <a href={fieldValue.value} target="_blank">
                {fieldValue.value}
              </a>
            ) : (
              <span>{fieldValue.value}</span>
            )}
          </div>
        ))}
      </div>
    ))}
  </div>
))}
```

---

### 4. TEMPLATES SYSTEM

#### 4.1 Database Changes

**Update Itinerary table:**
```typescript
Itinerary {
  // ... existing fields ...
  status: string // "draft", "published", "template"
  isTemplate: boolean
  templateName: string (optional) // e.g., "Ski Holiday", "Beach Vacation"
  templateDescription: string (optional)
}
```

#### 4.2 Dashboard with Tabs

**Update Dashboard.tsx:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BlckBx Logo          [Create New]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Published] [Drafts] [Templates]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Search: [___________] ğŸ”           â”‚
â”‚  Sort: [Recent] Filter: [All]       â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€ Itinerary Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Latvia Christmas           â”‚     â”‚
â”‚  â”‚ Riga, Latvia â€¢ Dec 25-28   â”‚     â”‚
â”‚  â”‚ Created: Nov 5, 2025       â”‚     â”‚
â”‚  â”‚ Status: Published          â”‚     â”‚
â”‚  â”‚ [View] [Edit] [Delete]     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Tab Logic:**
- **Published**: `status === "published"`
- **Drafts**: `status === "draft"`
- **Templates**: `isTemplate === true`

#### 4.3 Template Features

**Save as Template:**
- From any itinerary view page, add button: "Save as Template"
- Opens modal:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Save as Template                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Template Name:                     â”‚
â”‚  [e.g., Ski Holiday Template]       â”‚
â”‚                                     â”‚
â”‚  Description:                       â”‚
â”‚  [7-day ski trip with...  ]         â”‚
â”‚                                     â”‚
â”‚  This will create a reusable        â”‚
â”‚  template with all sections and     â”‚
â”‚  field structures (but no data).    â”‚
â”‚                                     â”‚
â”‚  [Cancel] [Save Template]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Create from Template:**
- On dashboard, when viewing Templates tab
- Each template card has "Use Template" button
- Copies structure (sections, fields) but not actual data
- Opens wizard pre-configured with template structure

**Pre-built Templates:**
Seed database with common templates:
- "Ski Holiday" (Accommodation, Ski Passes, Equipment Rental, Restaurants)
- "Beach Vacation" (Accommodation, Water Activities, Dining, Beach Clubs)
- "City Break" (Accommodation, Museums & Attractions, Restaurants, Shopping)
- "Road Trip" (Accommodation, Route Details, Fuel Stops, Attractions)
- "Motorhome Tour" (Charging/Fuel Points, Overnight Stops, Attractions, Groceries)

#### 4.4 API Routes

```typescript
// Templates
GET    /api/templates                    // List all templates
GET    /api/templates/:id                // Get template details
POST   /api/itineraries/:id/save-template // Save itinerary as template
POST   /api/templates/:id/create-from    // Create new itinerary from template
DELETE /api/templates/:id                // Delete template
```

---

### 5. DRAFT MANAGEMENT

**Auto-save Drafts:**
- While editing wizard, auto-save every 30 seconds
- Show "Saving..." / "Saved" indicator
- Store as `status: "draft"`

**Draft Actions:**
- Resume editing (loads wizard with saved data)
- Publish draft (changes status to "published")
- Delete draft

**Manual Save:**
- "Save as Draft" button on every wizard page
- Returns to dashboard
- Can resume later

---

### 6. DUPLICATE ITINERARY

**Add feature to duplicate existing itineraries:**

**From itinerary view page:**
- Add button: "Duplicate"
- Opens modal:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Duplicate Itinerary                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  New Title:                         â”‚
â”‚  [Copy of Latvia Christmas]         â”‚
â”‚                                     â”‚
â”‚  This will create a complete copy   â”‚
â”‚  of this itinerary that you can     â”‚
â”‚  edit independently.                â”‚
â”‚                                     â”‚
â”‚  [Cancel] [Duplicate]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API Route:**
```typescript
POST /api/itineraries/:id/duplicate
```

**Duplicates:**
- Itinerary base info
- All custom sections
- All custom fields
- All items and values
- Creates new unique slug

---

## MIGRATION STRATEGY

**For existing itineraries with old fixed schemas:**

1. Create migration script to convert old data to custom sections:
   - Accommodation â†’ Custom Section "Accommodation"
   - Activities â†’ Custom Section "Activities"
   - Dining â†’ Custom Section "Dining"
   
2. Map old fields to custom fields with appropriate types

3. After migration, drop old tables

---

## IMPLEMENTATION ORDER

1. Add clickable PDF links
2. Add Additional Notes page (Page 9)
3. Update dashboard with tabs (Published/Drafts/Templates)
4. Implement draft auto-save and management
5. Implement duplicate itinerary feature
6. Create custom sections database schema
7. Build section builder UI (add/edit sections)
8. Build field builder UI (add/edit fields within sections)
9. Build item management UI (add/edit items within sections)
10. Update itinerary display to render custom sections dynamically
11. Migrate existing data to custom sections
12. Implement template system (save as template, create from template)
13. Seed pre-built templates
14. Test all features thoroughly

---

## CRITICAL REQUIREMENTS

**Flexibility:**
- Users can create ANY section with ANY fields
- No limits on number of sections or fields
- Drag-and-drop to reorder everything

**Usability:**
- Section builder must be intuitive
- Preview what section looks like before saving
- Clear field type indicators (URL, Date, etc.)

**Data Integrity:**
- Cascade deletes (delete section â†’ delete fields â†’ delete values)
- Validate field types (URL must be valid URL, etc.)
- Save progress automatically

**Performance:**
- Loading custom sections should be fast (optimize queries)
- Auto-save shouldn't block UI

**Backwards Compatibility:**
- Migrate existing itineraries to custom sections
- Don't lose any data

---

## DELIVERABLES

- âœ… Clickable links in PDF exports
- âœ… Additional Notes page in wizard
- âœ… Fully customizable sections with custom fields
- âœ… Section builder UI
- âœ… Field builder UI
- âœ… Dashboard with Published/Drafts/Templates tabs
- âœ… Draft auto-save system
- âœ… Template creation and usage
- âœ… Pre-built templates
- âœ… Duplicate itinerary feature
- âœ… Dynamic section rendering
- âœ… Migration script for existing data

---

## TESTING CHECKLIST

- [ ] Create custom section from scratch
- [ ] Add custom fields of each type (text, url, date, number, etc.)
- [ ] Reorder sections and fields
- [ ] Add multiple items to a custom section
- [ ] Delete sections, fields, items
- [ ] Create itinerary with custom sections
- [ ] View itinerary displays custom sections correctly
- [ ] PDF export includes custom sections with clickable links
- [ ] Save itinerary as template
- [ ] Create new itinerary from template
- [ ] Auto-save drafts work
- [ ] Resume draft editing
- [ ] Publish draft
- [ ] Duplicate existing itinerary
- [ ] Filter dashboard by Published/Drafts/Templates
- [ ] Pre-built templates load correctly
- [ ] Migration of old data to custom sections

---

## NOTES

This is a major architectural change from fixed sections to fully dynamic custom sections. Take time to implement carefully. The custom section system is the foundation for ultimate flexibility - users can create itineraries for ANY type of trip with ANY information structure.